% Docs in  http://www.tex.ac.uk/ctan/macros/latex/contrib/memoir/memman.pdf

\input{metadata.tex}

\documentclass[letterpaper,oldfontcommands,11pt,extrafontsizes,onecolumn,oneside,openboth,final,titlepage]{memoir}
\usepackage[T1]{fontenc}
\usepackage{lmodern}
\usepackage{amssymb,amsmath}
\usepackage{ifxetex,ifluatex}
\usepackage{fixltx2e} % provides \textsubscript

% reduce page margins to a reasonable size
\setlrmarginsandblock{2.5cm}{2.5cm}{*}
\setulmarginsandblock{2.5cm}{2.5cm}{*}
\checkandfixthelayout


% use microtype if available
\IfFileExists{microtype.sty}{\usepackage{microtype}}{}
% use upquote if available, for straight quotes in verbatim environments
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}

\usepackage[utf8]{inputenc}
\usepackage{eurosym}

% http://tex.stackexchange.com/questions/37868/fancyhdr-and-memoir
\let\footruleskip\undefined

\usepackage{fancyhdr}
\renewcommand{\headrulewidth}{0pt}

% Chapter 2. Project Description ==> 2. Project Description
\renewcommand{\chaptermark}[1]{\markboth{\thechapter.\ #1}{}}

\fancypagestyle{plain}{  % used for pages that start new chapters
  \lhead{}
  \chead{}
  \rhead{}
  \cfoot{}
  \rfoot{\thepage/\thelastpage}
}

\fancypagestyle{gdocs}{
  \lhead{}
  \chead{}
  \rhead{\itshape{\nouppercase{\leftmark}}}
  \cfoot{}
  \rfoot{\thepage/\thelastpage}
}

\pagestyle{gdocs}

\chapterstyle{komalike} % also consider article, tandh


% used for printing google docs templates
\usepackage{longtable}
% used for printing google docs images
\usepackage{graphicx}
% We will generate all images so they have a width \maxwidth. This means
% that they will get their normal width if they fit onto the page, but
% are scaled down if they would overflow the margins.
\makeatletter
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth
\else\Gin@nat@width\fi}
\makeatother
\let\Oldincludegraphics\includegraphics
\renewcommand{\includegraphics}[1]{\Oldincludegraphics[width=\maxwidth]{#1}}

% used for google docs links
\usepackage[unicode=true]{hyperref}
\hypersetup{breaklinks=true,
            bookmarks=true,
            pdfauthor=, %TODO: fix the author
            pdftitle=\mytitle,
            colorlinks=true,
            urlcolor=blue,
            linkcolor=magenta,
            pdfborder={0 0 0}}

% Uncommnet to make embedded links print out HREF in footnotes, good for printing
% \renewcommand{\href}[2]{#2\footnote{\url{#1}}}

\setlength{\parindent}{0pt}
\setlength{\parskip}{7pt plus 2pt minus 1pt}
\setlength{\emergencystretch}{3em}  % prevent overfull lines

% Limits depth of automatic numbering of headings.
% 0 => Only H1 (chapters), 1 => Up to H2 (sections), 2 => Up to H3 (subsections)
\setcounter{secnumdepth}{2}

% memoir specific variable that lowers the title by 200pt
\setlength{\droptitle}{200pt}

% customize size and alignment of title and subtitle
\pretitle{\begin{flushleft}}
\title{\bfseries \HUGE \mytitle \\ \vskip .5em \LARGE \mysubtitle}
\posttitle{\par\vskip1em{\normalfont\normalsize\scshape \par\vfill}\end{flushleft}\vskip 0.5em}

% TODO generate the author somehow
% \author{}

% Suppress printing todays date.
% TODO: currently looks bad if not blank; make it look good and replace with todays date
\date{}

\begin{document}

\input{ew-header.tex}

\setcounter{tocdepth}{1}
\begin{KeepFromToc}
  \hypersetup{linkcolor=black}
  \tableofcontents
\end{KeepFromToc}

\input{main.tex}

\end{document}
